<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWì°¾ê¸°</title>
<style>
        /* í°íŠ¸ ë“±ë¡ */
        @font-face {
            font-family: 'PixelFont'; 
            src: url('../DungGeunMo.ttf') format('truetype'); 
            font-weight: normal;
            font-style: normal;
        }

        /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë° ë°°ê²½ */
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: url('../bgimg/í•˜ëŠ˜ë°°ê²½.png'); 
            background-size: cover;
            background-position: center;
            font-family: Arial, sans-serif;
            overflow: hidden;
            background-repeat: no-repeat;
            background-size: 60% auto;
            background-color: #87CEEB;
        }

        .container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'PixelFont', monospace;
        }

        /* ID ì°¾ê¸° ì°½ */
        .register-window {
            width: 600px;
            height: 480px; /* ë©”ì‹œì§€ ì˜ì—­ì„ ìœ„í•´ ë†’ì´ ìœ ì§€ */
            background-color: rgba(0, 0, 0, 0.8);
            border: 4px solid #3a3a3a;
            display: flex;
            flex-direction: column;
            color: #3a3a3a;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
            padding: 20px;
            box-sizing: border-box;
        }

        /* íƒ€ì´í‹€ ë°” */
        .title-bar {
            background-color: #3a3a3a;
            color: white;
            font-size: 24px;
            padding: 10px 0;
            text-align: center;
            margin-bottom: 5px;
            border-bottom: 2px solid #5a5a5a;
            text-shadow: 2px 2px 0 #000;
        }

        /* ì…ë ¥ í•„ë“œ ë° ë²„íŠ¼ ì»¨í…Œì´ë„ˆ */
        .content-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 30px; 
        }

        /* ì‘ë‹µ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        #responseMessage {
            margin-top: 20px;
            padding: 10px 20px; /* ê³ ì •ëœ íŒ¨ë”© ìœ ì§€ */
            border-radius: 4px;
            font-family: 'PixelFont', monospace;
            font-size: 16px;
            text-align: center;
            color: white;
            width: 80%;
            max-width: 500px;
            box-sizing: border-box;
            
            /* â­ï¸â­ï¸â­ï¸ ìˆ˜ì •: ìµœì†Œ ë†’ì´ë¥¼ ê³ ì •í•˜ì—¬ ê³µê°„ ìœ ì§€ â­ï¸â­ï¸â­ï¸ */
            min-height: 45px; 
            visibility: hidden; 
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            /* â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸ */
        }

        /* ë°°ê²½ í´ë˜ìŠ¤ */
        .bg-success { background-color: #28a745; border: 2px solid #1e7e34; }
        .bg-error { background-color: #dc3545; border: 2px solid #bd2130; }
        .bg-pending, .bg-info { background-color: #ffc107; border: 2px solid #d39e00; color: #333; }


        /* ë¼ë²¨ê³¼ ì…ë ¥ í•„ë“œë¥¼ ë¬¶ëŠ” ì»¨í…Œì´ë„ˆ */
        .input-field-container {
            display: flex;
            align-items: center;
            margin: 15px 0; 
            width: 80%;
            justify-content: space-between; 
            max-width: 500px;
        }

        .input-label {
            font-size: 16px;
            color: white;
            width: 120px; 
            flex-shrink: 0;
            text-align: left; 
        }

        /* ì´ë©”ì¼ ê·¸ë£¹ì˜ ë„ˆë¹„ë¥¼ ë‹¤ë¥¸ í•„ë“œë³´ë‹¤ ë„“ê²Œ ì¡°ì • */
        .email-input-group {
            display: flex;
            align-items: center;
            width: calc(100% - 120px); 
        }
        
        /* ì¼ë°˜ ì…ë ¥ í•„ë“œ (ID, ì¸ì¦ë²ˆí˜¸)ì˜ ë„ˆë¹„ */
        .input-field-container:not(:has(.email-input-group)) .input-field {
            width: calc(100% - 140px); 
        }

        .input-field {
            flex-grow: 1; 
            height: 40px;
            padding: 0 0px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            background-color: #fff;
            box-sizing: border-box; 
        }

        /* email-input-group ë‚´ì˜ input-field (ì´ë©”ì¼ ì…ë ¥ì°½) */
        .email-input-group .input-field {
            margin-right: 10px;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ í†µì¼ */
        .action-button {
            width: 95px; 
            height: 40px; 
            background-color: #28a745;
            color: white;
            font-size: 14px;
            padding: 0; 
            cursor: pointer;
            flex-shrink: 0; 
            text-shadow: 2px 2px 0 #218838;

            box-shadow: 
                -4px -4px 0 #7dd891 inset, 
                 4px  4px 0 #218838 inset;
            font-family: 'PixelFont', monospace;
            display: flex; 
            justify-content: center;
            align-items: center; 
        }

        .action-button:hover {
            background-color: #218838;
        }
        
        /* NEXT ë²„íŠ¼ */
        .next-button {
            width: 150px; 
            height: 50px; 
            margin: 20px 0 15px; 
            background-color: #d89617;
            color: white;
			font-family: 'PixelFont', monospace; 
            font-size: 24px; 
            border: 4px solid #8b4513;
           
            cursor: pointer;
            text-shadow: 2px 2px 0 #8b4513;
            box-shadow: 
                -4px -4px 0 #ffe082 inset, 
                 4px  4px 0 #8b4513 inset;
            line-height: 42px; 
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.1s;
        }

        .next-button:hover {
            background-color: #e0ac42;
        }
    </style>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const nextButton = document.querySelector('.next-button');
            const sendAuthButton = document.getElementById('send-auth-btn');
            const confirmAuthButton = document.getElementById('confirm-auth-btn');
            const authField = document.getElementById('auth-number');
            const emailField = document.getElementById('email');
            const nameField = document.getElementById('name'); 
            const responseDiv = document.getElementById('responseMessage'); 

            // ì´ˆê¸° ìƒíƒœ ì„¤ì •
            authField.disabled = true;
            confirmAuthButton.disabled = true;
            let isAuthConfirmed = false; 
            
            function displayResponse(div, text, type) {
                div.textContent = text;
                
                div.classList.remove('bg-info', 'bg-pending', 'bg-success', 'bg-error'); 
                
                // â­ï¸â­ï¸â­ï¸ ìˆ˜ì •: ê°€ì‹œì„± ë° íˆ¬ëª…ë„ë§Œ ì¡°ì •í•˜ì—¬ ê³µê°„ ìœ ì§€ â­ï¸â­ï¸â­ï¸
                if (type === 'hide' || text === '') {
                    div.style.visibility = 'hidden'; 
                    div.style.opacity = '0';
                    div.textContent = '';
                    div.classList.remove('bg-info', 'bg-pending', 'bg-success', 'bg-error'); 
                    return;
                }
                
                // ë©”ì‹œì§€ í‘œì‹œ ì‹œ
                div.style.visibility = 'visible'; 
                div.style.opacity = '1';
                // â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸

                if (type === 'success') {
                    div.classList.add('bg-success');
                } else if (type === 'error') {
                    div.classList.add('bg-error');
                } else if (type === 'pending') {
                    div.classList.add('bg-pending');
                } else {
                    div.classList.add('bg-info');
                }
            }
            
            // DOM ë¡œë“œ í›„ ì´ˆê¸° ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
            displayResponse(responseDiv, '', 'hide');


            // ----------------------------------------------------
            // 1. "ì¸ì¦ë²ˆí˜¸ ì „ì†¡" ë²„íŠ¼ í´ë¦­ ì‹œ (FindPwCheckServlet í˜¸ì¶œ)
            // ----------------------------------------------------
            sendAuthButton.addEventListener('click', function() {
                const loginId = nameField.value;
                const email = emailField.value;

                if (!loginId || !email) {
                    displayResponse(responseDiv, "IDì™€ ì´ë©”ì¼ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.", 'error');
                    return;
                }
                
                isAuthConfirmed = false; 
                displayResponse(responseDiv, 'ì´ë©”ì¼ì„ ì „ì†¡ ì¤‘ì…ë‹ˆë‹¤...', 'pending');
                
                // â­ï¸ ê²½ë¡œ ìˆ˜ì •: /team_project/findPWCheck â­ï¸
                const serverPath = "/team_project/findPWCheck"; 

                fetch(serverPath, { 
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: 
                        "loginId=" + encodeURIComponent(loginId) + 
                        "&email=" + encodeURIComponent(email)
                })
                .then(response => response.text())
                .then(text => {
                    if (text.startsWith("success")) {
                        displayResponse(responseDiv, "ì´ë©”ì¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!", 'success');
                        authField.disabled = false;
                        confirmAuthButton.disabled = false;
                    } else if (text.startsWith("error:")) {
                        const detailError = text.substring(6); 
                        
                        if (detailError.includes("ì¼ì¹˜í•˜ëŠ” ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")) {
                             displayResponse(responseDiv, "ì…ë ¥í•˜ì‹  IDì™€ ì´ë©”ì¼ì´ ì¼ì¹˜í•˜ëŠ” ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤.", 'error');
                        } else if (detailError.includes("ì´ë©”ì¼ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")) {
                             displayResponse(responseDiv, "ì„œë²„ ì„¤ì • ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.", 'error');
                        } else if (detailError.includes("í•„ìˆ˜ ì •ë³´")) {
                            displayResponse(responseDiv, "ID ë˜ëŠ” ì´ë©”ì¼ì„ í™•ì¸í•˜ì„¸ìš”.", 'error');
                        } else {
                            displayResponse(responseDiv, `ğŸš« ì „ì†¡ ì‹¤íŒ¨ (ì„œë²„): ${detailError}`, 'error');
                        }
                    } else {
                        displayResponse(responseDiv, 'ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
                    }
                })
                .catch(error => {
                    console.error('Auth Send error:', error);
                    displayResponse(responseDiv, 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ì¸ì¦ë²ˆí˜¸ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                });
            });

            // ----------------------------------------------------
            // 2. "ì¸ì¦í™•ì¸" ë²„íŠ¼ í´ë¦­ ì‹œ (FindPwVerifyCodeServlet í˜¸ì¶œ)
            // ----------------------------------------------------
            confirmAuthButton.addEventListener('click', function() {
                const loginId = nameField.value;
                const email = emailField.value;
                const authCode = authField.value;

                if (!authCode || authCode.length < 6) { 
                    displayResponse(responseDiv, "ì¸ì¦ë²ˆí˜¸ 6ìë¦¬ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.", 'error');
                    return;
                }
                
                displayResponse(responseDiv, 'ì¸ì¦ë²ˆí˜¸ë¥¼ í™•ì¸ ì¤‘...', 'info');
                
                // â­ï¸ ê²½ë¡œ ìˆ˜ì •: /team_project/FindPWverifyCode â­ï¸
                const serverPath = "/team_project/FindPWverifyCode"; 

                fetch(serverPath, { 
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body:
                        "loginId=" + encodeURIComponent(loginId) +
                        "&email=" + encodeURIComponent(email) +
                        "&authCode=" + encodeURIComponent(authCode)
                })
                .then(response => response.text())
                .then(text => {
                    if (text.startsWith("success")) {
                        displayResponse(responseDiv, "ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!", 'success');
                        isAuthConfirmed = true; 
                        authField.disabled = true; 
                        confirmAuthButton.disabled = true;
                    } else if (text.startsWith("error:")) {
                        const detailError = text.substring(6);

                        if (detailError.includes("ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤")) {
                            displayResponse(responseDiv, "ì¸ì¦ë²ˆí˜¸ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", 'error');
                        } else if (detailError.includes("ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤")) {
                            displayResponse(responseDiv, "ì…ë ¥í•˜ì‹  6ìë¦¬ ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.", 'error');
                        } else if (detailError.includes("ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤")) {
                            displayResponse(responseDiv, "ì¸ì¦ë²ˆí˜¸ ì „ì†¡ ë²„íŠ¼ì„ ë¨¼ì € ëˆŒëŸ¬ì£¼ì„¸ìš”.", 'error');
                        } else {
                            displayResponse(responseDiv, `ğŸš« ì¸ì¦ ì‹¤íŒ¨ (ì„œë²„): ${detailError}`, 'error');
                        }
                        isAuthConfirmed = false;
                    } else {
                        displayResponse(responseDiv, 'ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ë¡œ ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                        isAuthConfirmed = false;
                    }
                })
                .catch(error => {
                    console.error('Auth Confirm error:', error);
                    displayResponse(responseDiv, 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ì¸ì¦ í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    isAuthConfirmed = false;
                });
            });


            // ----------------------------------------------------
            // 3. "NEXT" ë²„íŠ¼ í´ë¦­ ì‹œ (FindPwServlet í˜¸ì¶œ)
            // ----------------------------------------------------
            nextButton.addEventListener('click', function() {
                const loginId = nameField.value;
                const email = emailField.value;
                
                if (!loginId || !email) {
                    displayResponse(responseDiv, "IDì™€ ì´ë©”ì¼ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.", 'error');
                    return;
                }

                if (!isAuthConfirmed) {
                    displayResponse(responseDiv, "ì´ë©”ì¼ ì¸ì¦ì„ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”. ", 'error');
                    return;
                }
                
                // ë©”ì‹œì§€ ìˆ˜ì •: ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ë°œê¸‰ -> ë¹„ë°€ë²ˆí˜¸ ì¡°íšŒ 
                displayResponse(responseDiv, "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¡°íšŒ ì¤‘ì…ë‹ˆë‹¤...", 'pending');
                
                // â­ï¸ ê²½ë¡œ ìˆ˜ì •: /team_project/findPW â­ï¸
                const serverPath = "/team_project/findPW"; 

                fetch(serverPath, { 
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body:
                        "loginId=" + encodeURIComponent(loginId) + 
                        "&email=" + encodeURIComponent(email)
                })
                .then(response => response.text())
                .then(text => {
                    if (text.startsWith("success")) {
                        // ë©”ì‹œì§€ ìˆ˜ì •: ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ë°œê¸‰ ì™„ë£Œ -> ë¹„ë°€ë²ˆí˜¸ ì¡°íšŒ ì™„ë£Œ 
                        displayResponse(responseDiv, "ë¹„ë°€ë²ˆí˜¸ ì¡°íšŒê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", 'success');
                        setTimeout(() => {
                            // FindPwServletì—ì„œ ì„¸ì…˜ì— ì €ì¥í•œ ì •ë³´ë¥¼ findPW2.htmlì—ì„œ í‘œì‹œí•  ê²ƒì…ë‹ˆë‹¤.
                            window.location.href = 'findPW2.html'; 
                        }, 1000); 
                        
                    } else if (text.startsWith("error:")) {
                         const detailError = text.substring(6);
                        
                        if (detailError.includes("ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì")) {
                            displayResponse(responseDiv, "ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", 'error');
                        } else if (detailError.includes("ì¼ì¹˜í•˜ëŠ” ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")) {
                            // FindPwServletì˜ ì—ëŸ¬ ë©”ì‹œì§€ì— ë§ê²Œ ì¡°ì •
                            displayResponse(responseDiv, "ì…ë ¥í•˜ì‹  ì •ë³´ë¡œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", 'error');
                        } else {
                            displayResponse(responseDiv, `ğŸš« ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ì‹¤íŒ¨ (ì„œë²„): ${detailError}`, 'error');
                        }
                    } else {
                        displayResponse(responseDiv, 'ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ë¡œ ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    }
                })
                .catch(error => {
                    console.error('Final PW Find error:', error);
                    displayResponse(responseDiv, 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                });
            });
        });
    </script>
</head>

<body>

    <div class="container">
        <div class="register-window">
            <div class="title-bar">PWì°¾ê¸°</div>

            <div class="content-area">
                <div class="input-field-container">
                    <label class="input-label" for="name">ID</label>
                    <input class="input-field" type="text" id="name" placeholder="IDë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div class="input-field-container">
                    <label class="input-label" for="email">ì´ë©”ì¼</label>
                    <div class="email-input-group">
                        <input class="input-field" type="email" id="email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        <button class="action-button" id="send-auth-btn">ì¸ì¦ë²ˆí˜¸ ì „ì†¡</button>
                    </div>
                </div>
                <div class="input-field-container">
                    <label class="input-label" for="auth-number">ì¸ì¦ë²ˆí˜¸</label>
                    <div class="email-input-group">
                        <input class="input-field" type="text" id="auth-number" placeholder="ì¸ì¦ë²ˆí˜¸ 6ìë¦¬" maxlength="6" required>
                        <button class="action-button" id="confirm-auth-btn">ì¸ì¦í™•ì¸</button>
                    </div>
                </div>

                <div id="responseMessage"></div>

                <button class="next-button">NEXT</button>
            </div>
        </div>
    </div>

</body>
</html>