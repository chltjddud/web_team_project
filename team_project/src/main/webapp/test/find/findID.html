<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDì°¾ê¸°</title>
<style>
        /* í°íŠ¸ ë“±ë¡ */
        @font-face {
            font-family: 'PixelFont'; 
            /* ì™¸ë¶€ íŒŒì¼ ê²½ë¡œëŠ” ê·¸ëŒ€ë¡œ ë‘¡ë‹ˆë‹¤. */
            src: url('../DungGeunMo.ttf') format('truetype'); 
            font-weight: normal;
            font-style: normal;
        }

        /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë° ë°°ê²½ */
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            /* ì™¸ë¶€ íŒŒì¼ ê²½ë¡œëŠ” ê·¸ëŒ€ë¡œ ë‘¡ë‹ˆë‹¤. */
            background-image: url('../bgimg/í•˜ëŠ˜ë°°ê²½.png'); 
            background-size: cover;
            background-position: center;
            font-family: Arial, sans-serif;
            overflow: hidden;
            background-repeat: no-repeat;
            background-size: 60% auto;
            background-color: #87CEEB;
        }

        .container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'PixelFont', monospace;
        }

        /* ID ì°¾ê¸° ì°½ (íšŒì›ê°€ì…ì—ì„œ IDì°¾ê¸°ë¡œ ì œëª© ë³€ê²½) */
        .register-window {
            width: 600px;
            height: 500px;
            background-color: rgba(0, 0, 0, 0.8);
            border: 4px solid #3a3a3a;
            display: flex;
            flex-direction: column;
            color: #3a3a3a;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
            padding: 20px;
            box-sizing: border-box;
        }

        /* íƒ€ì´í‹€ ë°” */
        .title-bar {
            background-color: #3a3a3a;
            color: white;
            font-size: 24px;
            padding: 10px 0;
            text-align: center;
            margin-bottom: 5px;
            border-bottom: 2px solid #5a5a5a;
            text-shadow: 2px 2px 0 #000;
        }

        /* ì…ë ¥ í•„ë“œ ë° ë²„íŠ¼ ì»¨í…Œì´ë„ˆ */
        .content-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 30px; 
        }
        
        /* ë¼ë²¨ê³¼ ì…ë ¥ í•„ë“œë¥¼ ë¬¶ëŠ” ì»¨í…Œì´ë„ˆ */
        .input-field-container {
            display: flex;
            align-items: center;
            margin: 15px 0; 
            width: 80%;
            justify-content: space-between; 
            max-width: 500px;
        }

        .input-label {
            font-size: 16px;
            color: white;
            width: 120px; 
            flex-shrink: 0;
            text-align: left; 
        }

        /* ì´ë©”ì¼ ê·¸ë£¹ì˜ ë„ˆë¹„ë¥¼ ë‹¤ë¥¸ í•„ë“œë³´ë‹¤ ë„“ê²Œ ì¡°ì • */
        .input-group {
            display: flex;
            align-items: center;
            width: calc(100% - 120px); /* 100% - label width */
        }
        
        .input-field {
            flex-grow: 1; 
            height: 40px;
            padding: 0 10px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            background-color: #fff;
            box-sizing: border-box; 
            min-width: 0; /* flex overflow ë°©ì§€ */
        }

        /* ì´ë©”ì¼ê³¼ ì¸ì¦ë²ˆí˜¸ ì…ë ¥ì°½ì˜ í•„ë“œ ë„ˆë¹„ ì¡°ì • */
        .input-group .input-field {
            margin-right: 10px; /* ë²„íŠ¼ê³¼ ê°„ê²© */
        }
        
        /* ì¸ì¦ë²ˆí˜¸ ì…ë ¥ í•„ë“œë§Œ ë„ˆë¹„ ì¡°ì • */
        .input-group.code-group .input-field {
            flex-grow: 0.8; /* ì¸ì¦ë²ˆí˜¸ í•„ë“œëŠ” ì¡°ê¸ˆ ë” ì‘ê²Œ */
        }


        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ í†µì¼ */
        .action-button {
            width: 95px; 
            height: 40px; 
            background-color: #28a745;
            color: white;
            font-size: 14px;
            padding: 0; 
            cursor: pointer;
            flex-shrink: 0; 
            text-shadow: 2px 2px 0 #218838;
            border: none; /* ê¸°ë³¸ ë²„íŠ¼ í…Œë‘ë¦¬ ì œê±° */

            box-shadow: 
                -4px -4px 0 #7dd891 inset, 
                 4px  4px 0 #218838 inset;
            font-family: 'PixelFont', monospace;
            display: flex; 
            justify-content: center;
            align-items: center; 
        }
        
        /* ì¸ì¦ë²ˆí˜¸ ì „ì†¡ ë²„íŠ¼ (ì´ë©”ì¼ ê·¸ë£¹ ì•ˆì— ìˆìŒ) */
        .send-auth-button {
            width: 120px;
            height: 40px; 
            background-color: #28a745;
            color: white;
            font-size: 14px;
            padding: 0; 
            cursor: pointer;
            flex-shrink: 0; 
            text-shadow: 2px 2px 0 #218838;

            box-shadow: 
                -4px -4px 0 #7dd891 inset, 
                 4px  4px 0 #218838 inset;
            font-family: 'PixelFont', monospace;
            display: flex; 
            justify-content: center;
            align-items: center; 
            border: none;
        }

        .action-button:hover {
            background-color: #218838;
        }
        
        .send-auth-button:hover {
            background-color: #218838;
        }
        
        /* ì‘ë‹µ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        #responseMessage {
            margin-top: 20px;
            padding: 10px 20px;
            border-radius: 4px;
            font-family: 'PixelFont', monospace;
            font-size: 16px;
            text-align: center;
            min-height: 16px; /* ìµœì†Œ ë†’ì´ ì„¤ì • */
            color: white;
            width: 80%;
            max-width: 500px;
            visibility: hidden; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
        }

        .bg-success { background-color: #28a745; border: 2px solid #1e7e34; }
        .bg-error { background-color: #dc3545; border: 2px solid #bd2130; }
        .bg-pending, .bg-info { background-color: #ffc107; border: 2px solid #d39e00; color: #333; }


        /* NEXT ë²„íŠ¼ */
        .next-button {
            width: 150px; 
            height: 50px; 
            margin: 40px 0 15px; 
            background-color: #d89617;
            color: white;
			font-family: 'PixelFont', monospace; 
            font-size: 24px; 
            border: 4px solid #8b4513;
            cursor: pointer;
            text-shadow: 2px 2px 0 #8b4513;
            box-shadow: 
                -4px -4px 0 #ffe082 inset, 
                 4px  4px 0 #8b4513 inset;
            line-height: 42px; 
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.1s;
        }

        .next-button:hover {
            background-color: #e0ac42;
        }
    </style>

    
</head>

<body>


    <div class="container">
        <div class="register-window">
            <div class="title-bar">ID ì°¾ê¸°</div> 
            <div class="content-area">
                
                <div class="input-field-container">
				    <label class="input-label" for="name">ì´ë¦„</label>
                    <input class="input-field" type="text" id="name" name="name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required style="width: calc(100% - 140px);">
				</div>
                
                <form id="sendCodeForm" action="/team_project/findIDCheck" method="POST" class="input-field-container">
                    <label class="input-label" for="email">ì´ë©”ì¼</label>
                    <div class="input-group">
                        <input class="input-field" type="email" id="email" name="email" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        <button type="submit" class="send-auth-button">ì¸ì¦ë²ˆí˜¸ ì „ì†¡</button>
                    </div>
                </form>
				
				<form id="verifyCodeForm" action="/team_project/FindverifyCode" method="POST" class="input-field-container">
                    <label class="input-label" for="authCode">ì¸ì¦ë²ˆí˜¸</label>
                    <div class="input-group code-group">
                        <input class="input-field" type="text" id="authCode" name="authCode" placeholder="ì¸ì¦ë²ˆí˜¸ 6ìë¦¬" required maxlength="6">
                        <button type="submit" class="action-button" id="confirm-auth-btn">ì¸ì¦í™•ì¸</button>
                    </div>
                </form>
                
                <div id="responseMessage"></div>

                <button class="next-button" id="nextButton">NEXT</button>
            </div>
        </div>
    </div>
    <script>
    let isAuthOK = false;

    document.addEventListener('DOMContentLoaded', function() {
        const nextButton = document.getElementById('nextButton');
        const responseDiv = document.getElementById('responseMessage');
        const nameInput = document.getElementById('name');
        const emailInput = document.getElementById('email');

        function displayResponse(div, text, type) {
            div.textContent = text;
            div.style.visibility = 'visible'; 

            div.classList.remove('bg-info', 'bg-pending', 'bg-success', 'bg-error'); 
            
            if (type === 'success') {
                div.classList.add('bg-success');
            } else if (type === 'error') {
                div.classList.add('bg-error');
            } else if (type === 'pending') {
                div.classList.add('bg-pending');
            } else if (type === 'hide') {
                div.style.visibility = 'hidden'; 
                div.textContent = '';
                return;
            } else {
                div.classList.add('bg-info');
            }
        }

        // â­ï¸ 1. ì´ë©”ì¼ ì¸ì¦ë²ˆí˜¸ ì „ì†¡ í¼ ì²˜ë¦¬ (FindIdCheckServlet í˜¸ì¶œ) â­ï¸
        document.getElementById('sendCodeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = e.target;
            const name = nameInput.value.trim();
            const email = emailInput.value.trim();

            if (!name || !email) {
                displayResponse(responseDiv, "ì´ë¦„ê³¼ ì´ë©”ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.", 'error'); 
                return;
            }

            isAuthOK = false; 
            displayResponse(responseDiv, 'ì´ë©”ì¼ì„ ì „ì†¡ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...', 'pending');
            
            const sendData = `name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}`;
            
            // â­ï¸ ìˆ˜ì •ëœ ê²½ë¡œë¡œ í†µì¼ â­ï¸
            fetch('/team_project/findIDCheck', { 
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: sendData 
            })
            .then(response => response.text())
            .then(text => {
                if (text.startsWith("success")) {
                    displayResponse(responseDiv, "ì´ë©”ì¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!", 'success');
                } else if (text.startsWith("error:")) {
                    const detailError = text.substring(6); 
                    
                    if (detailError.includes("ì´ë¦„ê³¼ ì´ë©”ì¼ì´ ì¼ì¹˜í•˜ëŠ” ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")) {
                         displayResponse(responseDiv, "âš ï¸ ì‚¬ìš©ì ì •ë³´ ë¶ˆì¼ì¹˜: ì…ë ¥í•˜ì‹  ì´ë¦„ê³¼ ì´ë©”ì¼ì´ ì¼ì¹˜í•˜ëŠ” ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤.", 'error');
                    } else if (detailError.includes("ì´ë©”ì¼ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")) {
                         displayResponse(responseDiv, "âŒ ì´ë©”ì¼ ì „ì†¡ ì˜¤ë¥˜: ì„œë²„ ì„¤ì • ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.", 'error');
                    } else if (detailError.includes("í•„ìˆ˜ ì •ë³´")) {
                        displayResponse(responseDiv, "âš ï¸ í•„ìˆ˜ ì •ë³´ ëˆ„ë½: ì´ë¦„ ë˜ëŠ” ì´ë©”ì¼ì„ í™•ì¸í•˜ì„¸ìš”.", 'error');
                    } else {
                        displayResponse(responseDiv, `ğŸš« ì „ì†¡ ì‹¤íŒ¨ (ì„œë²„): ${detailError}`, 'error');
                    }
                } else {
                    displayResponse(responseDiv, 'ğŸš« ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
                }
            })
            .catch(error => {
                console.error('Send Code error:', error);
                displayResponse(responseDiv, 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ì„œë²„ì™€ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
            });
        });
        
        // 2. ì¸ì¦ë²ˆí˜¸ í™•ì¸ í¼ ì²˜ë¦¬ (FindVerifyCodeServlet í˜¸ì¶œ)
        document.getElementById('verifyCodeForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const form = e.target;
            const authCode = document.getElementById('authCode').value.trim();
            const email = emailInput.value.trim(); 
            
            if (!authCode || !email) {
                displayResponse(responseDiv, "ì´ë©”ì¼ê³¼ ì¸ì¦ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.", 'error');
                return;
            }

            const sendData = `authCode=${encodeURIComponent(authCode)}&email=${encodeURIComponent(email)}`;
            
            displayResponse(responseDiv, 'ğŸ”’ ì¸ì¦ë²ˆí˜¸ë¥¼ í™•ì¸ ì¤‘...', 'info');

            fetch(form.action, {// /team_project/FindverifyCode
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: sendData
            })
            .then(response => response.text())
            .then(text => {
                if (text.startsWith("success")) {
                    displayResponse(responseDiv, "ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!", 'success');
                    isAuthOK = true;
                } else if (text.startsWith("error:")) {
                    const detailError = text.substring(6);
                    
                    if (detailError.includes("ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤")) {
                        displayResponse(responseDiv, "â±ï¸ ì¸ì¦ ì‹œê°„ ë§Œë£Œ: ì¸ì¦ë²ˆí˜¸ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ìš”ì²­í•´ì£¼ì„¸ìš”.", 'error');
                    } else if (detailError.includes("ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤")) {
                        displayResponse(responseDiv, "âŒ ì¸ì¦ë²ˆí˜¸ ë¶ˆì¼ì¹˜: ì…ë ¥í•˜ì‹  6ìë¦¬ ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.", 'error');
                    } else if (detailError.includes("ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤")) {
                        displayResponse(responseDiv, "âš ï¸ ì¸ì¦ ì •ë³´ ì—†ìŒ: ì´ë©”ì¼ ì „ì†¡ ë²„íŠ¼ì„ ë¨¼ì € ëˆŒëŸ¬ì£¼ì„¸ìš”.", 'error');
                    } else {
                        displayResponse(responseDiv, `ğŸš« ì¸ì¦ ì‹¤íŒ¨ (ì„œë²„): ${detailError}`, 'error');
                    }
                    isAuthOK = false;
                } else {
                    displayResponse(responseDiv, 'ğŸš« ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ë¡œ ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    isAuthOK = false;
                }
            })
            .catch(error => {
                console.error('Fetch error:', error);
                displayResponse(responseDiv, 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ì„œë²„ì™€ í†µì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                isAuthOK = false;
            });
        });
        

        // â­ï¸ 3. NEXT ë²„íŠ¼: ìµœì¢… ID ì¡°íšŒ ì„œë¸”ë¦¿ í˜¸ì¶œ â­ï¸
        nextButton.addEventListener('click', function () { 
            const name = nameInput.value.trim();
            const email = emailInput.value.trim();

            if (!name || !email) { 
                displayResponse(responseDiv, "ì´ë¦„ê³¼ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", 'error'); 
                return;
            }

            if (!isAuthOK) {
                // ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
                displayResponse(responseDiv, "ì´ë©”ì¼ ì¸ì¦ì„ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”. (ì¸ì¦í™•ì¸ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”)", 'error');
                return;
            }
            
            findFinalId(name, email); 
        });

        // ìµœì¢… ID ì¡°íšŒ ë° ê²°ê³¼ í˜ì´ì§€ ì´ë™ í•¨ìˆ˜
        function findFinalId(name, email) {
            
            const serverPath = "/team_project/findID"; // FindIdServlet ê²½ë¡œ 
            displayResponse(responseDiv, "IDë¥¼ ì¡°íšŒ ì¤‘ì…ë‹ˆë‹¤...", 'pending');

            fetch(serverPath, { 
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body:
                    "name=" + encodeURIComponent(name) + 
                    "&email=" + encodeURIComponent(email)
            })
            .then(response => response.text())
            .then(text => {
                if (text.startsWith("success")) {
                    displayResponse(responseDiv, "ID ì¡°íšŒ ì„±ê³µ! ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.", 'success');
                    
                    setTimeout(() => {
                        window.location.href = "findID2.html"; 
                    }, 1000);
                    
                } else if (text.startsWith("error:")) {
                     const detailError = text.substring(6);
                    
                    if (detailError.includes("ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì")) {
                        displayResponse(responseDiv, "ğŸš« ì˜¤ë¥˜: ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ê±°ë‚˜ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì¸ì¦í•´ì£¼ì„¸ìš”.", 'error');
                    } else if (detailError.includes("ì¼ì¹˜í•˜ëŠ” IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")) {
                        displayResponse(responseDiv, "âš ï¸ ID ì—†ìŒ: ì…ë ¥í•˜ì‹  ì •ë³´ë¡œ ë“±ë¡ëœ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", 'error');
                    } else {
                        displayResponse(responseDiv, `ğŸš« ID ì¡°íšŒ ì‹¤íŒ¨ (ì„œë²„): ${detailError}`, 'error');
                    }
                } else {
                    displayResponse(responseDiv, 'ğŸš« ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ë¡œ ID ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            })
            .catch(error => {
                console.error('Final ID Find error:', error);
                displayResponse(responseDiv, 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ID ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            });
        }
    });
    </script>
</body>
</html>