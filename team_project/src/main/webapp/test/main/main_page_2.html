<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MINI GAME 메인 페이지</title>
    <style>
        /* 1. 폰트 등록: main_page.html과 동일 */
        @font-face {
            font-family: 'PixelFont'; 
            src: url('../DungGeunMo.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            /* 배경 이미지 설정: 일관성 유지 */
            background-image: url('../bgimg/game_배경.png'); 
            background-size: cover;
            background-position: center;
            font-family: Arial, sans-serif;
            overflow: hidden;
            background-repeat: no-repeat;
    		background-size: 60% auto;
    		background-color: #87CEEB;
        }

        .container {
            position: relative;
            width: 800px; 
            height: 600px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* 상단에서부터 시작 */
            padding-top: 50px;
        }

        /* 2. MINI GAME 제목 이미지 스타일 */
        .game-title-image {
            width: 400px;
            height: auto; 
            margin-bottom: 30px; 
            z-index: 10;
        }

        /* ⭐️ [신규] 환영 메시지를 감싸는 컨테이너 스타일 ⭐️ */
        .welcome-container {
            /* 하늘색 배경, 부드러운 모서리 (픽셀 느낌을 위해 4px 사용) */
            background-color: rgba(135, 206, 235, 0.9); /* 하늘색: #87CEEB */
            border: 4px solid #fff; /* 흰색 테두리 */
            border-radius: 8px; /* 부드러운 모서리 */
            padding: 10px 20px; /* 내부 여백 */
            margin-bottom: 50px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* 그림자 효과 */
            text-align: center;
        }

        /* ⭐️ [수정] 사용자 환영 메시지 스타일 (컨테이너 내부에 위치) ⭐️ */
        .welcome-message {
            font-family: 'PixelFont', monospace;
            font-size: 35px; /* 요청하신 43px 반영 */
            color: #333; /* 배경색과 대비되도록 글자색을 어둡게 변경 */
            text-shadow: 2px 2px 0 #fff; /* 글자 주변의 그림자를 흰색으로 변경하여 대비 강화 */
            margin: 0; /* 컨테이너의 패딩을 사용하므로 내부 마진 제거 */
        }

        /* ⭐️ 버튼 그룹 컨테이너 (세로 정렬을 위한 핵심) ⭐️ */
        .button-group {
            display: flex;
            flex-direction: column; /* 세로로 배치 */
            align-items: center;
            width: 150px; /* 버튼 너비에 맞춤 */
        }

        /* ⭐️ 요청하신 .next-button 스타일 ⭐️ */
        .next-button {
            width: 220px; 
            height: 63px; 
            /* 세로 배치와 중앙 정렬을 위해 마진 조정 */
            margin: 15px 0; 
            background-color: #d89617;
            color: white;
            font-size: 37px; 
            border: 4px solid #8b4513;
            cursor: pointer;
            text-shadow: 3px 3px 0 #8b4513;
            box-shadow: 
                -6px -6px 0 #ffe082 inset, 
                 6px  6px 0 #8b4513 inset;
            line-height: 42px; 
            padding: 0;
            box-sizing: border-box;
            font-family: 'PixelFont', monospace; 
        }

        .next-button:hover {
            background-color: #e0ac42;
        }
        
        /* ⭐️ 로그아웃 링크 스타일: 유지 ⭐️ */
        .logout-link {
            font-family: 'PixelFont', monospace;
            color: #fff;
            margin-top: 50px;
            text-shadow: 1px 1px 0 #333;
            text-decoration: none;
            font-size: 16px;
        }
        .logout-link:hover {
             color: #d89617; 
        }
    </style>
    </head>
<body>
    <div class="container">
        <img 
            src="../bgimg/minigame_배경X.png" 
            alt="MINI GAME" 
            class="game-title-image"
        >

        <div class="welcome-container">
            <div id="welcomeMessage" class="welcome-message">
                로그인 중... 
            </div>
        </div>

        <div class="button-group">
            <button class="next-button" onclick="location.href='MY PAGE 경로'">
                MY PAGE
            </button>
            
            <button class="next-button" onclick="location.href='../gamelist/gamelist.html'">
                START
            </button>
        </div>
        
        <a href="/team_project/logout" class="logout-link">로그아웃</a> 
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const welcomeElement = document.getElementById('welcomeMessage');
        // HTML 파일 위치: .../test/main/
        // 서블릿 경로: /api/userInfo (프로젝트 루트 매핑)
        const userInfoApiUrl = '../../api/userInfo'; 
        
        fetch(userInfoApiUrl)
            .then(response => {
                if (response.status === 401) {
                    // 로그인 페이지로 강제 리다이렉트
                    window.location.href = '/team_project/test/main/main_page.html?error=sessionExpired';
                    return Promise.reject('세션이 만료되었거나 로그인되어 있지 않습니다.');
                } 
                if (!response.ok) {
                    welcomeElement.textContent = '정보 로드 실패';
                    throw new Error('서버 응답 오류: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                if (data.isLoggedIn) {
                    welcomeElement.textContent = data.displayName + '님, 환영합니다!';
                    
                    // 스코어 저장을 위해 userId 저장 (유지)
                    window.currentUserId = data.userId;
                    console.log("세션에서 가져온 사용자 ID (스코어 저장용):", window.currentUserId);
                } else {
                    welcomeElement.textContent = '로그인 정보 없음';
                }
            })
            .catch(error => {
                console.error('사용자 정보 로드 중 오류:', error);
                if (error !== '세션이 만료되었거나 로그인되어 있지 않습니다.') {
                    welcomeElement.textContent = '오류 발생. 다시 시도해 주세요.';
                }
            });
    });
    </script>
</body>
</html>